import sys
import Ice
import rospy
from .ice.motorsIceClient import MotorsIceClient

if (sys.version_info[0] == 2):
    from .ros.publisherMotors import PublisherMotors

def __getMotorsIceClient(jdrc, prefix):
    '''
    Returns a Motors Ice Client. This function should never be used. Use getMotorsClient instead of this

    @param jdrc: JdeRobotComm Communicator
    @param prefix: Name of client in config file

    @type jdrc: JdeRobotComm Communicator
    @type prefix: String

    @return Motors Ice Client

    '''
     print("Publishing "+ prefix +" with ICE interfaces")
    client = MotorsIceClient(jdrc, prefix)
    client.start()
    return client

def __getPublisherMotors(jdrc, prefix):
    '''
    Returns a Motors ROS Publisher. This function should never be used. Use getMotorsClient instead of this

    @param jdrc: JdeRobotComm Communicator
    @param prefix: Name of client in config file

    @type jdrc: JdeRobotComm Communicator
    @type prefix: String

    @return Motors ROS Publisher

    '''
    if (sys.version_info[0] == 2):
        print("Publishing "+  prefix + " with ROS messages")
        cfg = jdrc.getConfig(prefix)
        topic = cfg["Topic"]

        maxW = cfg["maxW"]
        if not maxW:
            maxW = 0.5
            print (prefix+".maxW not provided, the default value is used: "+ repr(maxW))
                

        maxV = cfg["maxV"]
        if not maxV:
            maxV = 5
            print (prefix+".maxV not provided, the default value is used: "+ repr(maxV))

        
        client = PublisherMotors(topic, maxV, maxW)
        return client
    else:
        print(prefix + ": ROS msg are diabled for python "+ sys.version_info[0])
        return None

def __Motorsdisabled(jdrc, prefix):
    '''
    Prints a warning that the client is disabled. This function should never be used. Use getMotorsClient instead of this

    @param jdrc: JdeRobotComm Communicator
    @param prefix: Name of client in config file

    @type jdrc: JdeRobotComm Communicator
    @type prefix: String

    @return None

    '''
    print(prefix + " Disabled")
    return None

def getMotorsClient (jdrc, name):
    '''
    Returns a Motors Client.

    @param jdrc: JdeRobotComm Communicator
    @param prefix: Name of client in config file
    @param node: ROS node

    @type jdrc: JdeRobotComm Communicator
    @type prefix: String
    @type node: ROS node

    @return None if Motors is disabled

    '''
    cfg = jdrc.getConfig(name)
    server = cfg["Server"]
    if not server:
        server=0

    cons = [__Motorsdisabled, __getMotorsIceClient, __getPublisherMotors]

    return cons[server](jdrc, name)